# Fuzzer Autopilot Configuration
# Run with: uv run fuzz --config fuzzer.toml

[execution]
max_runs = 1000              # Number of runs (omit for unlimited)
duration_slots = 5           # Duration: use duration_secs, duration_slots, or duration_epochs
master_seed = 42             # For reproducibility (omit for random)
trace_on_anomaly_only = true # Only save traces for anomalies

[output]
dir = "fuzzer_output"
overview_file = "runs.ndjson"

# Parameter ranges for randomized config generation

[ranges.network]
node_count = { min = 8000, max = 15000 }
mesh_degree = { min = 50, max = 50 }  # fixed at 50

[ranges.protocol]
provider_probability = { min = 0.15, max = 0.15 }  # fixed at 0.15
min_providers_before_sample = { min = 2, max = 2 }  # fixed at 2
extra_random_columns = { min = 1, max = 2 }
max_columns_per_request = { min = 16, max = 16 }  # fixed at 16

[ranges.timeouts]
provider_observation_timeout = { min = 12.0, max = 36.0 }  # 1-3 slots
request_timeout = { min = 5.0, max = 5.0 }  # fixed at 5s
tx_expiration = { min = 300.0, max = 1800.0 }  # 5-30 minutes

[ranges.limits]
blobpool_max_bytes = { min = 536870912, max = 1073741824 }  # 512MiB to 1GiB
max_txs_per_sender = { min = 16, max = 16 }  # fixed at 16

[ranges.scenario]
mempool_saturation_target = { min = 0.5, max = 1.5 }  # multiplier of max_blobs_per_block per slot

# Node type configurations per EIP-7870
# Proportions are normalized at runtime to sum to 1

[[node_types]]
name = "full_node"
download_mbps = 50
upload_mbps = 15
custody_columns = { min = 4, max = 4 }  # fixed at 4
proportion = { min = 0.60, max = 0.80 }

[[node_types]]
name = "attester"
download_mbps = 50
upload_mbps = 25
custody_columns = { min = 8, max = 128 }
proportion = { min = 0.10, max = 0.25 }

[[node_types]]
name = "local_block_builder"
download_mbps = 100
upload_mbps = 50
custody_columns = { min = 8, max = 128 }
proportion = { min = 0.05, max = 0.10 }

[[node_types]]
name = "supernode"
download_mbps = 1000
upload_mbps = 1000
custody_columns = { min = 128, max = 128 }  # fixed at 128
proportion = { min = 0.01, max = 0.05 }

# Anomaly detection thresholds

[thresholds]
max_p99_propagation_time = 10.0           # Flag if > 10s
min_reconstruction_success_rate = 0.95    # Flag if < 95%
max_false_availability_rate = 0.05        # Flag if > 5%
min_provider_coverage_ratio = 0.8         # Flag if < 80% of expected p
min_local_availability_met = 0.99         # Flag if < 99% local availability
min_da_checks_passed_rate = 0.99          # Flag if < 99% DA checks pass
